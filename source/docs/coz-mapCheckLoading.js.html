<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: coz-mapCheckLoading.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: coz-mapCheckLoading.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Function to check if the Mapbox map is done loading
 * @memberof cozMAP
 * @method mapCheckLoading
 * @events fires 'mapIsLoaded' event when the map is done loading and removes a 'loading' class on an id 'loading' if one exists
 * @param {object} map mapbox map object to check
 */

function mapCheckLoading(m, callback) {

  var mapIsLoaded = (typeof (Event) === 'function') ? new Event('mapIsLoaded') : new CustomEvent('mapIsLoaded')

  var _x = 0;
  var _checkLoadedInterval;

  //FIRE THIS FUNCTION ONLY ONCE, ON INITIAL MAP LOAD, THIS WILL TRIGGER AN EVENT TO THE MAP TO LET THE CLIENT KNOW THAT ALL THE LAYERS HAVE LOADED
  m.once('sourcedataloading', function (e) {
    if (_x === 0) {
      _checkLoadedInterval = setInterval(checkIfMapTilesAreLoaded, 500);
      console.log('map has started loading tiles');
      console.log('checkIfMapTilesAreLoaded is waiting for sourcedataloading to complete');
      // m._container.classList.add('d-invisible');
    }
    _x = 1
  });

  function checkIfMapTilesAreLoaded() {
    if (m.areTilesLoaded()) {
      window.clearInterval(_checkLoadedInterval);
      document.dispatchEvent(mapIsLoaded);
      console.log('sourcedataloading is complete, mapIsLoaded fired');
      _x = 0;    
    }
  }

  if (document.getElementById('loading')) {
    document.addEventListener('mapIsLoaded', function () {
      // if (sessionStorage.getItem('cozaccept')) {
        if (document.getElementById("loading")) {
          var newLoading = document.getElementById('loading');
          newLoading.classList.remove('loading');
        }
        if (callback) { callback(m) }
      // }
    });
  }
}

export {
  mapCheckLoading
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="mglStreetViewControl.html">mglStreetViewControl</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addIEPolyfills">addIEPolyfills</a></li><li><a href="global.html#checkedToggleLayers">checkedToggleLayers</a></li><li><a href="global.html#cozSidebarToggleControl">cozSidebarToggleControl</a></li><li><a href="global.html#createStory">createStory</a></li><li><a href="global.html#genId">genId</a></li><li><a href="global.html#getJSON">getJSON</a></li><li><a href="global.html#getLayers">getLayers</a></li><li><a href="global.html#getParent">getParent</a></li><li><a href="global.html#getQuery">getQuery</a></li><li><a href="global.html#hasLayer">hasLayer</a></li><li><a href="global.html#highlight">highlight</a></li><li><a href="global.html#highlightAddFeature">highlightAddFeature</a></li><li><a href="global.html#highlightClearFeature">highlightClearFeature</a></li><li><a href="global.html#highlightLayerPaint">highlightLayerPaint</a></li><li><a href="global.html#highlightReset">highlightReset</a></li><li><a href="global.html#mapAddLayers">mapAddLayers</a></li><li><a href="global.html#mapCheckRendered">mapCheckRendered</a></li><li><a href="global.html#mapGetInfo">mapGetInfo</a></li><li><a href="global.html#mapillaryLayers">mapillaryLayers</a></li><li><a href="global.html#mapMeasureControl">mapMeasureControl</a></li><li><a href="global.html#mapSelectOnLoad">mapSelectOnLoad</a></li><li><a href="global.html#RulerControl">RulerControl</a></li><li><a href="global.html#showBoundingBox">showBoundingBox</a></li><li><a href="global.html#streetViewIcon">streetViewIcon</a></li><li><a href="global.html#updateQueryStringParam">updateQueryStringParam</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Jan 22 2021 13:54:41 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
